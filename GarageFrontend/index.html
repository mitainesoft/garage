<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!--<meta name="generator" content="Responsive Site Designer 1.5.1390">-->
    <title>Mitaine Garage</title>

    <!--<script src="../js/jquery-3.2.1.js"></script>-->
    <!--<script src="../js/jquery.mobile-1.4.5.min.js"></script>-->

    <link rel="stylesheet" href="../css/coffeegrinder.min.css">
    <link rel="stylesheet" href="../css/wireframe-theme.min.css">
    <link rel="stylesheet" href="../css/main.css">

    <!--<link href="http://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" type="text/css"/>-->
    <link rel="stylesheet" href="../css/flaticon.css">


    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <!--<script>document.createElement("picture");</script>-->
    <!--<script src="../js/picturefill.min.js" class="picturefill" async="async"></script>-->

</head>

<body>

<div data-role="page" id="foo" class="row NavPicture">

    <div data-role="header">

        <div class="coffee-span-12 coffee-670-span-12">
            <h1 class="MainTitle">Mitaine Garage</h1>
            <h3>Anti-Mule Systeme</h3>
        </div>
        <div data-role="navbar">
            <ul>
                <li><a class="flaticon-font glyphs-icon glyph flaticon-house-3 ui-btn-active" href="index.html"></a></li>
                <li><a class="flaticon-font glyphs-icon glyph flaticon-cctv" href="index.html"></a></li>
                <li><a class="flaticon-font glyphs-icon glyph flaticon-info" href="about.html"></a></li>
            </ul>

        </div>

    </div><!-- /header -->

    <div role="main" class="ui-content coffee-span-12 call-out">

        <!--<h5 class="smallTitle2">Commandes</h5>-->
        <!--<h1 class="MainTitle3">Porte 0</h1>-->
        <a id="garagecmd0" class="link-button opendoorbutton nav-button flaticon-garage" href="#"
           onclick="proceed('open','0');">0</a>

        <a id="garagestatus0" class="link-button nav-button unknownstatusdoorbutton  flaticon-garage" href="#"
           onclick="doorStatus();">S0</a>
        <br></br>


        <!--<h1 class="MainTitle3">Porte 1</h1>-->
        <a id="garagecmd1" class="link-button nav-button opendoorbutton  flaticon-garage" href="#"
           onclick="proceed('open','1');">1</a>
        <a id='garagestatus1' class="link-button nav-button errordoorbutton  flaticon-garage" href="#"
           onclick="doorStatus();">S1</a>
        <br></br>

        <!--<h1 class="MainTitle3">Alertes</h1>-->
        <a class="link-button nav-button errordoorbutton flaticon-garbage" href="#" onclick="proceed('clear','0');">Alarmes</a>
        <a class="link-button nav-button errordoorbutton flaticon-info" href="#" onclick="doorStatus();"></a>

    </div><!-- /content -->


    <div data-role="footer">
        <div class="coffee-span-12"><a href="#" target="_blank" class="social-image socialicon"><img
                class="facebook-icon" src="../socialicons/webicon-facebook.png" alt="Social Icon"></a><a href="#"
                                                                                                         target="_blank"
                                                                                                         class="social-image socialicon"><img
                class="instagram-icon" src="../socialicons/webicon-instagram.png" alt="Social Icon"></a><a href="#"
                                                                                                           target="_blank"
                                                                                                           class="social-image socialicon"><img
                class="twitter-icon" src="../socialicons/webicon-twitter.png" alt="Social Icon"></a><a href="#"
                                                                                                       target="_blank"
                                                                                                       class="social-image socialicon"><img
                class="googleplus-icon" src="../socialicons/webicon-googleplus.png" alt="Social Icon"></a><a
                href="#"
                target="_blank"
                class="social-image socialicon"><img
                class="linkedin-icon" src="../socialicons/webicon-linkedin.png" alt="Social Icon"></a>
        </div>

        <div class="coffee-span-12">
            <p class="paragraph Footer">Ile-Bizard<br>(514) 594 3818 mitainesoft@gmail.com</p>
            <p class="paragraph FooterCredit"><span <a title="Mitainesoft" href="http://www.github.com/mitainesoft/"
                                                       class="p-link">Mitainesoft</a></span>
            </p>
        </div>
    </div><!-- /footer -->

    <script>
        function proceed(subcmd, id) {
            var cmd = 'http://192.168.1.83:8050/GarageDoor/' + subcmd + '/' + id
            var posting = $.post(cmd, function (data) {
                parseResponse(data);
            })
        }

        function doorStatus() {
            for (count = 0; count <= 1; count++) {

                cmd = 'http://192.168.1.83:8050/GarageDoor/status/' + count
                garageid = "garagestatus" + count;
                posting = $.post(cmd, function (data) {
                    parseResponse(data, status)
                }, null, "text")

                //            $("[id^='garagestatus0']").text("Allo"+count)
                // $("#"+ garageid).text("Hello"+count)
//        $("body").find("#"+garageid).text("Hello"+count);
//              alert("status: " + data);
            }
        }
        function parseResponse(data) {
            // alert("Garage reponse: " + data)
            // document.write(data)
            // document.write("<br></br>")
            // tid:00001497820533214351 [DeviceManager] GARAGE_0:CLOSED tid:00000000001497820533 [AlertManager] Alertlist=None
            if (data == null) return;
//            var re = new RegExp('/tid\:(\d+)\s+(\[DeviceManager\])\s+(\w+)\:(\w+)\s+tid\:(\d+)\s+\[AlertManager\]\s\w+\=(.*)');
//            var tmpstr="tid:00001497820533214351 [DeviceManager] GARAGE_0:CLOSED tid:00000000001497820533 [AlertManager] Alertlist=None";

            tmpstr=data.toString();
            var myArray = tmpstr.match(/tid\:(\d+)\s+(\[DeviceManager\])\s+(\w+)\:(\w+)\s+tid\:(\d+)\s+\[AlertManager\]\s(\w+)\=(.*)/);
            document.writeln("<br></br>");
            document.writeln("'"+tmpstr+"'");

            if(myArray==null) return ;
            document.writeln("<br></br>");
            document.writeln("array:"+myArray)
            document.writeln("<br></br>");
            document.writeln("0:"+myArray[0]);
            document.writeln("<br></br>");
            document.writeln("1:"+myArray[1]);
            document.writeln("<br></br>");
            document.writeln("2:"+myArray[2]);
            document.writeln("<br></br>");
            document.writeln("3:"+myArray[3]);
            document.writeln("<br></br>");
            document.writeln("4:"+myArray[4]);
            document.writeln("<br></br>");
            document.writeln("5:"+myArray[5]);
            document.writeln("<br></br>");
            document.writeln("6:"+myArray[6]);
            document.writeln("<br></br>");
            document.writeln("7:"+myArray[7]);
            document.writeln("<br></br>");


            document.write("<br></br>");
            console.log("ZPS0009");
            console.log(myArray);



//            var tidcount=0;
//            var tidnextpos=0;
//            while (tidpos=data.indexOf("tid:",tidnextpos)>=0) {
//
//                tidnextpos+=tidpos;
//                tidcount++;
//            }
//
//            if (tidcount==0) return;
//
//            var devmanagerpos=data.indexOf("[DeviceManager]")
//            var alertmanagerpos=data.indexOf("[AlertManager]")


            var partsArray = data.split('-');
        }

    </script>
</div><!-- /page -->
</body>

</html>